<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Steuerung</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: system-ui, sans-serif;
      padding: 16px;
      background: #f5f5f5;
    }
    .card {
      background: #fff;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    input, button {
      font-size: 16px;
      padding: 8px;
      width: 100%;
      box-sizing: border-box;
      margin-top: 8px;
    }
    button {
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:disabled {
      background: #aaa;
    }
  </style>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>

<h1>Steuerseite</h1>

<!-- PAIRING-BEREICH (minimal, oben eingefÃ¼gt) -->
<div class="card">
  <h2>Pairing</h2>

  <label>Display-ID</label>
  <input id="displayId" value="kirche-beamer-1">

  <label>Pairing-Code von der Anzeige</label>
  <input id="pairingCode">

  <button onclick="pair()">Verbinden</button>

  <div id="status">Nicht verbunden</div>
</div>

<!-- DEINE ORIGINALEN BUTTONS -->
<div class="card">
  <h2>Aktionen</h2>
  <button onclick="sendAction('anzeigen')" id="btnAnzeigen" disabled>Anzeigen</button>
  <button onclick="sendAction('ausblenden')" id="btnAusblenden" disabled>Ausblenden</button>
  <button onclick="sendAction('speichern')" id="btnSpeichern" disabled>Speichern</button>
</div>

<script>
  // Deine Firebase-Konfiguration
  const firebaseConfig = {
    apiKey: "AIzaSyDPZF_SoHChy3efmhlC4vGcdT62zYzKhsA",
    authDomain: "liedanzeige-3b1dc.firebaseapp.com",
    databaseURL: "https://liedanzeige-3b1dc-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "liedanzeige-3b1dc",
    storageBucket: "liedanzeige-3b1dc.firebasestorage.app",
    messagingSenderId: "615806685064",
    appId: "1:615806685064:web:7c4e2d7403fe4a813d743d"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let token = null;

  // Token-Erzeugung kompatibel mit Fully / Android-TV
  function generateToken() {
    return Date.now() + "-" + Math.random().toString(36).substring(2);
  }

  function pair() {
    const displayId = document.getElementById("displayId").value.trim();
    const enteredCode = document.getElementById("pairingCode").value.trim();

    db.ref(`displays/${displayId}/pairingCode`).once("value").then(snap => {
      if (snap.val() !== enteredCode) {
        alert("Falscher Pairing-Code");
        return;
      }

      token = generateToken();
      db.ref(`displays/${displayId}/token`).set(token);

      document.getElementById("status").textContent = "Verbunden";

      // Buttons aktivieren
      document.getElementById("btnAnzeigen").disabled = false;
      document.getElementById("btnAusblenden").disabled = false;
      document.getElementById("btnSpeichern").disabled = false;
    });
  }

  function sendAction(action) {
    const displayId = document.getElementById("displayId").value.trim();

    db.ref(`displays/${displayId}/control`).set({
      action: action,
      token: token,
      ts: Date.now()
    });
  }
</script>

</body>
</html>