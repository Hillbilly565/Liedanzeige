<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Liedanzeige</title>

<style>
  body {
    margin: 0;
    padding: 0;
    background: black;
    color: white;
    font-family: "Segoe UI", Arial, sans-serif;
    overflow: hidden;
  }

  #display {
    width: 100%;
    text-align: center;
    transition: opacity 0.3s ease;
  }

  #song {
    font-weight: bold;
    white-space: nowrap;
  }

  #verses {
    margin-top: 2vh;
    white-space: nowrap;
  }
</style>
</head>

<body>

<div id="display">
  <div id="song"></div>
  <div id="verses"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

  // ðŸ”¥ DEINE FIREBASE CONFIG HIER
  const firebaseConfig = {
    apiKey: "AIzaSyDPZF_SoHChy3efmhlC4vGcdT62zYzKhsA",
    authDomain: "liedanzeige-3b1dc.firebaseapp.com",
    databaseURL: "https://liedanzeige-3b1dc-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "liedanzeige-3b1dc",
    storageBucket: "liedanzeige-3b1dc.firebasestorage.app",
    messagingSenderId: "615806685064",
    appId: "1:615806685064:web:7c4e2d7403fe4a813d743d"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const disp = document.getElementById("display");
  const songEl = document.getElementById("song");
  const versesEl = document.getElementById("verses");

  // ðŸ”¥ 1. Beim Start: DOM komplett leeren & ausblenden
  disp.style.opacity = "0";
  disp.style.visibility = "hidden";
  songEl.textContent = "";
  versesEl.textContent = "";

  // ðŸ”¥ 2. Ersten Firebase-Snapshot ignorieren
  let firstSnapshot = true;

  onValue(ref(db, "anzeige"), (snapshot) => {
    const data = snapshot.val() || {};

    if (firstSnapshot) {
      firstSnapshot = false;

      // Sicherheit: alles leer halten
      disp.style.opacity = "0";
      disp.style.visibility = "hidden";
      songEl.textContent = "";
      versesEl.textContent = "";

      return; // ðŸ‘‰ erster Snapshot wird komplett ignoriert
    }

    const visible = data.visible || "no";
    const song = data.song || "";
    const verses = data.verses || "";

    // ðŸ”¥ Sichtbarkeit steuern
    if (visible === "no") {
      disp.style.opacity = "0";
      disp.style.visibility = "hidden";
    } else {
      disp.style.opacity = "1";
      disp.style.visibility = "visible";
    }

    // Text setzen
    songEl.textContent = song;
    versesEl.textContent = verses;

    // SchriftgrÃ¶ÃŸenlogik
    if (!verses || verses.trim() === "") {
      versesEl.style.display = "none";
      fitTextToWidth(songEl, 25, 10);
    } else {
      versesEl.style.display = "block";
      songEl.style.fontSize = "18vw";
      versesEl.style.fontSize = "12vw";
      fitTextToWidth(songEl, 18, 10);
      fitTextToWidth(versesEl, 12, 8);
    }

    centerVertically();
  });

  function fitTextToWidth(element, maxSizeVW, minSizeVW) {
    let size = maxSizeVW;
    element.style.fontSize = size + "vw";

    while (element.scrollWidth > window.innerWidth * 0.95 && size > minSizeVW) {
      size -= 1;
      element.style.fontSize = size + "vw";
    }
  }

  function centerVertically() {
    const totalHeight = disp.offsetHeight;
    const freeSpace = window.innerHeight - totalHeight;
    disp.style.marginTop = Math.max(freeSpace / 2, 0) + "px";
  }

  window.addEventListener("resize", centerVertically);
</script>

</body>
</html>